<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="MFIN7036 Students 2023" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", Progress Report, " />

<meta property="og:title" content="Journey of Nasdaq 100 Sentiment Prediction (by Group &#34;N.5&#34;) "/>
<meta property="og:url" content="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/journey-of-nasdaq-100-sentiment-prediction-by-group-n5.html" />
<meta property="og:description" content="By Group &#34;N.5&#34;. We are N.5, aiming to discover investment opportunities hiding behind market factors. General thought of Project The issue of stock market prediction has always attracted great interest from both academic and business communities. But are financial markets really predictable? Traditional finance is based on the …" />
<meta property="og:site_name" content="MFIN7036 Student Blog 2023" />
<meta property="og:article:author" content="MFIN7036 Students 2023" />
<meta property="og:article:published_time" content="2023-03-15T01:12:00+08:00" />
<meta name="twitter:title" content="Journey of Nasdaq 100 Sentiment Prediction (by Group &#34;N.5&#34;) ">
<meta name="twitter:description" content="By Group &#34;N.5&#34;. We are N.5, aiming to discover investment opportunities hiding behind market factors. General thought of Project The issue of stock market prediction has always attracted great interest from both academic and business communities. But are financial markets really predictable? Traditional finance is based on the …">

        <title>Journey of Nasdaq 100 Sentiment Prediction (by Group &#34;N.5&#34;)  · MFIN7036 Student Blog 2023
</title>
        <link href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="MFIN7036 Student Blog 2023 - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/"><span class=site-name>MFIN7036 Student Blog 2023</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://buehlmaier.github.io/MFIN7036-student-blog-2023-02
                                    >Home</a>
                                </li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/categories.html">Categories</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/tags.html">Tags</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/journey-of-nasdaq-100-sentiment-prediction-by-group-n5.html">
                Journey of Nasdaq 100 Sentiment Prediction (by Group "N.5")
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>By Group "N.5". We are N.5, aiming to discover investment opportunities hiding behind market factors.</p>
<h2>General thought of Project</h2>
<p>The issue of stock market prediction has always attracted great interest from both academic and business communities. But are financial markets really predictable? Traditional finance is based on the random walk and efficient market hypothesis. And according to the efficient market hypothesis theory, stock prices movement depend on emerging of information (such as news) rather than on past or future stock prices.</p>
<p>Many studies have also shown that financial markets are not a completely random process. To some extent, there is a degree of predictability in financial markets. For example, it is true that we cannot predict the emergence of new information in the market, but it is possible to capture some signs from social networking media (Twitter, Facebook, other blogs, etc.) and use them to predict, to some extent, future changes in sentiment and information in the economy and society.</p>
<p>In a paper <a href="https://www.sciencedirect.com/science/article/abs/pii/S187775031100007X">Twitter mood predicts the stock market</a>, researchers at Indiana University and Manchester University used tweets posted by users on Twitter to analyze sentiment through two sentiment analysis models, namely OpinionFinder and Google-Profile of Mood States (GPOMS), to capture and analyze changes in public sentiment.</p>
<p>Different from predicting the movement of individual stocks, we are planning to focus on forecasting the movement of Nasdaq 100 stock index. By analyzing the sentiments of all stocks in a specific time period, we will forecast the overall Nasdaq 100 stock index up or down movement. Then, we will figure out the best model for accuracy prediction.</p>
<h2>Data Resource and Data Scraping</h2>
<ul>
<li>
<p>Tweets Data with Nasdaq100 tickers cashtag</p>
</li>
<li>
<p>Historical financial Nasdaq100 data from <a href="https://finance.yahoo.com/">Yahoo! Finance</a></p>
</li>
</ul>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-Yahoofinance-logo.png"></p>
<p><strong>Nasdaq100 Data</strong></p>
<p>We get the Nasdaq100 ticker weights online, see the example below:</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-NDXdata.png"></p>
<p>Then we import pdfplumber to Plumb this PDF file for detailed information about each text character, rectangle, and line. After some data cleaning, we transfer the pdf into csv version. </p>
<p><strong> Tweets Data</strong></p>
<p>In this step, we want to get tweets that contained Nasdaq 100 ticker cashtag and cleaned the data for further use. In order to get enough data for our research, we decide to scrape a half year tweets and financial data from 2022-07-01 to 2022-12-31. However, we tried different ways to get the tweets data. </p>
<p>At first, we tried followthehashtag.com, a Twitter search analytics and business intelligence tool. We expect to get the negative and positive tweets with cashtags as following. However, the information on the website is outdated, and difficult to sign in.</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-followthehashtagexample.png"></p>
<p>Then, we tried to use Twitter API, which is the official tweets scraping tool. However, Tweepy does not allow recovery of tweets beyond a week window, so historical data retrieval is not permitted, so it is hard for us to retrieval the specific time period we want. Also, there are limits to how many tweets you can retrieve from a user's account.</p>
<p>After failure in using twitter API, we tried tweet scraper, but is incompatible with current software, and there will have too many missing data, and incorrespond data after web scraping. </p>
<p>Finally, we choose snscrape, a scraper for social networking services. It scrapes things like user profiles, hashtags, or searches and returns the discovered items. 
The code we use is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Extracting the tweets by snscrape</span>
<span class="n">df_lst</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">cashtags</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">stock</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(from:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">) until:2022-12-31 since:2022-07-01&#39;</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="mi">50000</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">sntwitter</span><span class="o">.</span><span class="n">TwitterSearchScraper</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">get_items</span><span class="p">():</span>
        <span class="c1"># print(vars(tweet))</span>
        <span class="c1"># break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span> <span class="o">==</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">tweet</span><span class="o">.</span><span class="n">lang</span> <span class="o">!=</span> <span class="s1">&#39;en&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tweets</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stock</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">followersCount</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="n">tweet</span><span class="o">.</span><span class="n">likeCount</span><span class="p">,</span><span class="n">tweet</span><span class="o">.</span><span class="n">lang</span><span class="p">])</span>
    <span class="n">df_stock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cashtag&#39;</span><span class="p">,</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Followers&#39;</span><span class="p">,</span> <span class="s1">&#39;Tweet&#39;</span><span class="p">,</span><span class="s1">&#39;likes&#39;</span><span class="p">,</span><span class="s1">&#39;languages&#39;</span><span class="p">])</span>
    <span class="n">df_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_stock</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_lst</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">file_path</span><span class="o">+</span><span class="s1">&#39;/old_tweets.pq&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="o">+</span><span class="s1">&#39;/old_tweets.csv&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Then we get the half year tweets data, that include name of the hashtag, date, Tweets, etc.</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-raw-tweetsdata.png"></p>
<p><strong>Stock Data</strong></p>
<p>We got the Nasdaq 100 stock price data from Yahoo! Finance. </p>
<div class="highlight"><pre><span></span><code><span class="n">stock_pr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tqdm</span><span class="p">(</span><span class="n">ndx_100</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]):</span><span class="w"></span>
<span class="w">    </span><span class="n">data_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2022-07-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;cashtag&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">stock</span><span class="w"></span>
<span class="w">    </span><span class="c1"># get stock info</span><span class="w"></span>
<span class="w">    </span><span class="n">stock_pr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="w"></span>

<span class="n">stock_pr_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">stock_pr</span><span class="p">)</span><span class="w"></span>
<span class="n">stock_pr_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="o">+</span><span class="s1">&#39;/stock_price.csv&#39;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>The following example is the CSV file we download from Yahoo! Finance, it contains basic information including the open and close daily price of Nasdaq 100 tickers.</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-raw-stockdata.png"></p>
<p>Then we create two new roles, "HLPCT" and "PCTchange". The formula and codes in the following:</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-HLPCTformula.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">ndx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;^NDX&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;2022-07-01&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">ndx</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">)</span><span class="w"></span>

<span class="n">helper</span><span class="w"> </span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>\<span class="w"></span>
<span class="n">end</span><span class="o">=</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;1d&#39;</span><span class="p">)})</span><span class="w"></span>

<span class="n">ndx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">helper</span><span class="p">,</span><span class="n">ndx</span><span class="p">,</span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">how</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="w"></span>

<span class="n">ndx</span><span class="p">[</span><span class="n">ndx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">=</span><span class="n">ndx</span><span class="p">[</span><span class="n">ndx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="p">:</span>\<span class="w"> </span>
<span class="n">x</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;HLPCT&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">]</span><span class="w"></span>
<span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;PCTchange&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">ndx</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span><span class="w"></span>
<span class="n">ndx</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="o">+</span><span class="s1">&#39;/nasdaq100.csv&#39;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>Result we obtain:</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-Nasdaq100.png"></p>
<h2>Data Cleaning and Sentiment Analysis</h2>
<p>In this part we will guide you through our exploration of twitter text analysis.</p>
<p><strong>Text Processing</strong></p>
<p>First, we decide to transform all texts corresponding to all stocks for each day into sentiment scores, then manually multiplied and transformed into 1-dimensional features to predict Nasdaq 100 Index up or down pricing. </p>
<p>However, after training the machine learning classifiers with the data (Including logistic Regression, Support Vector Machine, Decision Tree, and Random Forest etc), the results, after running each of the stocks through each of the 5 binary classifiers and cross-validation, accuracy of each classifier was just between 45% to 55%. We did not recognize any connection between sentiment score on twitter and Nasdaq 100 Index ups and downs. </p>
<p>Fix the problem: We found that since NASDAQ 100 index is a weighting of 100 stocks, there will be some steps missing when learning the total ups and downs directly from the characteristics of 100 stocks. It is to use 1 model to predict the up and down values of 100 stocks, and then weight and sum the predicted values to get the final NASDAQ up and down, instead of directly predicting the overall NASDAQ up and down (because the weights and summation formula are known). Also, with only one model, there will be more training data.</p>
<p><strong>Choosing Sentiment Analysis</strong></p>
<p>Since the number of tweets and the length of text are not fixed, we want to use word frequency statistics such as tf-idf are used to transform the features into fixed-length ones, or use rnn deep learning models for processing indefinite length sequences.</p>
<p>We simplified the problem to a binary classification. When we get the prediction of the index price for next day, if it shows positive, then we assign it as up movement with 1, if it is negative, we assign it -1 as downward movement. As a result, the performance of the models were much better.</p>
<p>Later, we found that Vader is good for sentiment analysis of social media text data, so we started to learn the principle and usage of this package, and finally used it for sentiment analysis. Below is code of the data processing stage using Vader:</p>
<div class="highlight"><pre><span></span><code><span class="n">Tweet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tweets</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[&#39;</span><span class="nl">Unnamed:</span><span class="w"> </span><span class="mh">0</span><span class="p">&#39;]).</span><span class="n">copy</span><span class="p">()</span><span class="w"></span>
<span class="n">Tweet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tweet</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;].</span><span class="n">isna</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">False</span><span class="p">]</span><span class="w"></span>

<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="p">&#39;</span><span class="n">http\S+&#39;,&#39;&#39;,i)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;]]</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="s">&quot;[$]\S+&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;]]</span><span class="w"></span>

<span class="p">#</span><span class="n">The</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">assigning</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sentiment</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">tweet</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">sentimentScore</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">analyzer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">sentence</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nl">Tweet:</span><span class="w"></span>
<span class="w">        </span><span class="n">vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyzer</span><span class="p">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">results</span><span class="w"></span>

<span class="n">df_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sentimentScore</span><span class="p">(</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Tweet</span><span class="p">&#39;]))</span><span class="w"></span>

<span class="n">Tweet</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span><span class="p">)</span><span class="w"></span>
<span class="n">Tweet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Tweet</span><span class="p">,</span><span class="n">df_results</span><span class="p">],</span><span class="n">axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">)</span><span class="w"></span>
<span class="p">#</span><span class="n">Tweet</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[&#39;</span><span class="nl">Unnamed:</span><span class="w"> </span><span class="mh">0</span><span class="p">&#39;],</span><span class="n">inplace</span><span class="o">=</span><span class="n">True</span><span class="p">)</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path_2</span><span class="o">+</span><span class="p">&#39;</span><span class="o">/</span><span class="n">tweets_with_senti_scores</span><span class="p">.</span><span class="n">csv</span><span class="p">&#39;,</span><span class="n">index</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="w"></span>
<span class="n">Tweet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tweet</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">compound</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Date</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Date</span><span class="p">&#39;]).</span><span class="n">apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="err">\</span><span class="w"> </span>
<span class="n">x</span><span class="p">.</span><span class="n">strftime</span><span class="p">(&#39;</span><span class="o">%</span><span class="n">Y</span><span class="o">/%</span><span class="n">m</span><span class="o">/%</span><span class="n">d</span><span class="p">&#39;))</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Date</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Date</span><span class="p">&#39;])</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">log_followers</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Followers</span><span class="p">&#39;])</span><span class="w"></span>
<span class="n">Tweet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tweet</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Followers</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"></span>
<span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">Compound_multiplied</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">log_followers</span><span class="p">&#39;]</span><span class="o">*</span><span class="n">Tweet</span><span class="p">[&#39;</span><span class="n">compound</span><span class="p">&#39;]</span><span class="w"></span>

<span class="n">senti_score</span><span class="o">=</span><span class="n">Tweet</span><span class="p">[[&#39;</span><span class="n">cashtag</span><span class="sc">&#39;,&#39;</span><span class="n">Date</span><span class="sc">&#39;,&#39;</span><span class="n">compound</span><span class="sc">&#39;,&#39;</span><span class="n">Compound_multiplied</span><span class="p">&#39;]].</span><span class="n">groupby</span><span class="w"> </span><span class="se">\</span><span class="w"></span>
<span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[&#39;</span><span class="n">cashtag</span><span class="sc">&#39;,&#39;</span><span class="n">Date</span><span class="p">&#39;]).</span><span class="n">mean</span><span class="p">()</span><span class="w"></span>
<span class="n">senti_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">senti_score</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

<p>Combine the data together:</p>
<div class="highlight"><pre><span></span><code><span class="n">stock_full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">senti_score</span><span class="p">.</span><span class="k">merge</span><span class="p">(</span><span class="n">stock_pr_df</span><span class="p">,</span><span class="k">on</span><span class="o">=[</span><span class="n">&#39;cashtag&#39;,&#39;Date&#39;</span><span class="o">]</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">stock_full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock_full</span><span class="p">.</span><span class="n">loc</span><span class="o">[</span><span class="n">stock_full[&#39;compound&#39;</span><span class="o">]</span><span class="p">.</span><span class="n">isna</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">False</span><span class="err">]</span><span class="w"></span>
<span class="n">stock_price_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&#39;Open&#39;,&#39;High&#39;,&#39;Low&#39;,&#39;Close&#39;,&#39;Adj Close&#39;,&#39;Volume&#39;</span><span class="o">]</span><span class="w"></span>
<span class="n">stock_full</span><span class="o">[</span><span class="n">stock_price_info</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock_full</span><span class="o">[</span><span class="n">stock_price_info</span><span class="o">]</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="n">x</span><span class="p">.</span><span class="n">interpolate</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;HLPCT&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;High&#39;</span><span class="o">]-</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;Low&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">/</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;Low&#39;</span><span class="o">]</span><span class="w"></span>
<span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;PCTchange&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;Close&#39;</span><span class="o">]-</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;Open&#39;</span><span class="o">]</span><span class="p">)</span><span class="err">\</span><span class="w"></span>
<span class="o">/</span><span class="n">stock_full</span><span class="o">[</span><span class="n">&#39;Open&#39;</span><span class="o">]</span><span class="w"></span>

<span class="n">stock_full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock_full</span><span class="p">.</span><span class="k">merge</span><span class="p">(</span><span class="n">ndx_100</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;cashtag&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Cashtags&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">stock_full</span><span class="p">.</span><span class="k">drop</span><span class="p">(</span><span class="n">columns</span><span class="w"> </span><span class="o">=[</span><span class="n">&#39;Cashtags&#39;</span><span class="o">]</span><span class="p">,</span><span class="n">inplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="n">stock_full</span><span class="o">[</span><span class="n">[&#39;PCTchange_lag_1&#39;</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock_full</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">by</span><span class="o">=[</span><span class="n">&#39;cashtag&#39;</span><span class="o">]</span><span class="p">)</span><span class="err">\</span><span class="w"></span>
<span class="o">[</span><span class="n">[&#39;PCTchange&#39;</span><span class="o">]</span><span class="err">]</span><span class="p">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="n">stock_full</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=[</span><span class="n">&#39;PCTchange_lag_1&#39;</span><span class="o">]</span><span class="p">,</span><span class="n">inplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"></span>
<span class="n">stock_full</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path_2</span><span class="o">+</span><span class="s1">&#39;/stock_full.csv&#39;</span><span class="p">,</span><span class="k">index</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<h2>Modeling</h2>
<p>In this part, we will simply interpret the model we pick and the performance of the models. More results of the modeling and future improvements can be seen in the report.</p>
<p>We first define the data_train and data_test:</p>
<div class="highlight"><pre><span></span><code><span class="nf">data</span><span class="err">=</span><span class="no">stock_full</span><span class="p">[[</span><span class="err">&#39;</span><span class="no">Date</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">ticker</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">compound</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">Compound_multiplied</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">Close</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">HLPCT</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="err">&#39;</span><span class="nf">Volume</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">PCTchange</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">Weights</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="no">PCTchange_lag_1</span><span class="err">&#39;</span><span class="p">]]</span><span class="w"></span>
<span class="nf">data_train</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="no">data.loc</span><span class="p">[</span><span class="no">v</span><span class="p">[:</span><span class="no">round</span><span class="p">(</span><span class="no">len</span><span class="p">(</span><span class="no">v</span><span class="p">)*</span><span class="mi">0</span><span class="no">.8</span><span class="p">)]]</span><span class="w"> </span><span class="no">for</span><span class="w"> </span><span class="no">g</span><span class="p">,</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">in</span><span class="w"> </span><span class="no">data.groupby</span><span class="p">(</span><span class="err">&#39;</span><span class="no">ticker</span><span class="err">&#39;</span><span class="p">)</span><span class="err">\</span><span class="w"></span>
<span class="na">.groups.items</span><span class="p">()]</span><span class="w"></span>
<span class="nf">data_train</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">pd.concat</span><span class="p">(</span><span class="no">data_train</span><span class="p">)</span><span class="w"></span>
<span class="nf">data_test</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="no">data.loc</span><span class="p">[</span><span class="no">v</span><span class="p">[</span><span class="no">round</span><span class="p">(</span><span class="no">len</span><span class="p">(</span><span class="no">v</span><span class="p">)*</span><span class="mi">0</span><span class="no">.8</span><span class="p">):]]</span><span class="w"> </span><span class="no">for</span><span class="w"> </span><span class="no">g</span><span class="p">,</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">in</span><span class="w"> </span><span class="no">data.groupby</span><span class="p">(</span><span class="err">&#39;</span><span class="no">ticker</span><span class="err">&#39;</span><span class="p">)</span><span class="err">\</span><span class="w"></span>
<span class="na">.groups.items</span><span class="p">()]</span><span class="w"></span>
<span class="nf">data_test</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">pd.concat</span><span class="p">(</span><span class="no">data_test</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>The Lecture notes also mentions Neural Networks, ISTM, BERT, and other models, but they are more complicated to use, thus we first tried traditional machine learning model. Replace the classification model with regression model where the prediction target is a specific up or down value instead of plus or minus 1 (the prediction target will be more continuous), then convert the model prediction results (real numbers) to +1 or -1 (Nasdaq 100 Index ups or downs) and then calculate the accuracy.</p>
<p>Different from the model we expect to use during the planning stage, We use models including Linear regression, Decision Tree, SVM, XGboost, and lightGBM. Before we write the code, we also install the sklearn package on python, and import those package at the beginning of code writing:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
</code></pre></div>

<p>The code of the five model can be seen below:</p>
<div class="highlight"><pre><span></span><code><span class="p">#</span><span class="n">Linear</span><span class="w"> </span><span class="n">Regression</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">LR</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linear_model</span><span class="p">.</span><span class="n">LinearRegression</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="n">print</span><span class="p">(</span><span class="n">clf</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">))</span><span class="w">   </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="w"></span>

<span class="p">#</span><span class="n">Decision</span><span class="w"> </span><span class="n">Tree</span><span class="w"> </span><span class="n">regressor</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">DTreg</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DecisionTreeRegressor</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="n">print</span><span class="p">(</span><span class="n">clf</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="w"></span>

<span class="p">#</span><span class="n">SVR</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">SVRreg</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SVR</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">#</span><span class="n">print</span><span class="p">(</span><span class="n">clf</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="w"></span>

<span class="p">#</span><span class="n">XGboost</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">XGBreg</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mh">123</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">clf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="w"> </span><span class="n">y_train</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">#</span><span class="n">print</span><span class="p">(</span><span class="n">lgb</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="w"></span>

<span class="p">#</span><span class="n">LightGBM</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">lgb</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">lgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mh">123</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">lgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lgb</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="w"> </span><span class="n">y_train</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">#</span><span class="n">print</span><span class="p">(</span><span class="n">lgb</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">lgb</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>Then we split the stock_full data as train and test sets in order to evaluate the performance of machine learning algorithm. </p>
<div class="highlight"><pre><span></span><code>x_train = np.array(data_train[[&#39;compound&#39;,&#39;Compound_multiplied&#39;,&#39;HLPCT&#39;,\
&#39;Volume&#39;,&#39;PCTchange&#39;]])
y_train = np.array(data_train[&#39;PCTchange_lag_1&#39;])

x_test = np.array(data_test[[&#39;compound&#39;,&#39;Compound_multiplied&#39;,&#39;HLPCT&#39;,\
&#39;Volume&#39;,&#39;PCTchange&#39;]])
y_test = np.array(data_test[&#39;PCTchange_lag_1&#39;])
</code></pre></div>

<p><strong>To get the performance of each model</strong></p>
<p>We create confusion matrix for further results analysis. Below is an example of the linear regression model, By changing the first line LR to different model definitions, we will get different results for each model, and compare the accuracy between different model.</p>
<div class="highlight"><pre><span></span><code>y_pred = LR(y_train,x_train,x_test,y_test)
y_pred_operations = y_pred.copy()
data_test[&#39;pred_PCTchange&#39;] = y_pred_operations
data_test[&#39;NDX_pred_PCTchange&#39;] = data_test[&#39;pred_PCTchange&#39;]*data_test[&#39;Weights&#39;]

y_pred_NDX = data_test.groupby(by=&#39;Date&#39;).sum()[&#39;NDX_pred_PCTchange&#39;]
y_pred_NDX = y_pred_NDX.reset_index()

ndx[&#39;Date&#39;] = pd.to_datetime(ndx[&#39;Date&#39;])

#y_NDX = ndx.loc[ndx[&#39;Date&#39;].isin(y_pred_NDX[&#39;Date&#39;]),[&#39;Date&#39;,&#39;PCTchange&#39;]]
y_NDX = ndx.loc[ndx[&#39;Date&#39;].isin(y_pred_NDX[&#39;Date&#39;]),[&#39;Date&#39;,&#39;PCTchange&#39;]]

y_pred_NDX[&#39;NDX_pred_PCTchange&#39;][y_pred_NDX[&#39;NDX_pred_PCTchange&#39;] &gt;= 0] = 1
y_pred_NDX[&#39;NDX_pred_PCTchange&#39;][y_pred_NDX[&#39;NDX_pred_PCTchange&#39;] &lt; 0] = -1
y_test_NDX = y_NDX.copy()
y_test_NDX[&#39;PCTchange&#39;][y_test_NDX[&#39;PCTchange&#39;] &gt;= 0] = 1
y_test_NDX[&#39;PCTchange&#39;][y_test_NDX[&#39;PCTchange&#39;] &lt; 0] = -1
score = accuracy_score(y_test_NDX[&#39;PCTchange&#39;], y_pred_NDX[&#39;NDX_pred_PCTchange&#39;])

confusion_matrix = metrics.confusion_matrix(y_test_NDX[&#39;PCTchange&#39;], y_pred_NDX[&#39;NDX_pred_PCTchange&#39;])
cm_display = metrics.ConfusionMatrixDisplay(confusion_matrix = confusion_matrix, display_labels = [False, True])
cm_display.plot()

targetnames = [&#39;Down&#39;,&#39;Up&#39;]
print(classification_report(y_test_NDX[&#39;PCTchange&#39;], y_pred_NDX[&#39;NDX_pred_PCTchange&#39;],target_names = targetnames))

RocCurveDisplay.from_predictions(y_test_NDX[&#39;PCTchange&#39;], y_pred_NDX[&#39;NDX_pred_PCTchange&#39;])
print(score)
</code></pre></div>

<p>Below is an example of the confusion matrix and classification report we get for the linear regression model, we can see the overall accuracy of model.</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-Lineareg_pic.png"></p>
<p>After running all of the models, we combine all of the model together and it shows the clear result of each model's accuracy.</p>
<p><img alt="Picture" src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/images/N5-Post01_group5-resultmodel.png"></p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2023-03-15T01:12:00+08:00">Wed 15 March 2023</time>
            <h4>Category</h4>
            <a class="category-link" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/categories.html#progress-report-ref">Progress Report</a>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/buehlmaier/MFIN7036-student-blog-2023-02" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>