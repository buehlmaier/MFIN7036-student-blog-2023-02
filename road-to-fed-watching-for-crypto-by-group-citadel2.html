<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="MFIN7036 Students 2023" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", Progress Report, " />

<meta property="og:title" content="Road to Fed-Watching for Crypto (by Group &#34;Citadel2&#34;) "/>
<meta property="og:url" content="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/road-to-fed-watching-for-crypto-by-group-citadel2.html" />
<meta property="og:description" content="Group Citadel2 Introduction In this group project, we set out to analyse the effects of Fed speeches on cryptocurrency returns with natural language processing (NLP) techniques. Given this aim, it is all but necessary to 1) collect data in a timely and accurate manner, and 2) process and analyse the …" />
<meta property="og:site_name" content="MFIN7036 Student Blog 2023" />
<meta property="og:article:author" content="MFIN7036 Students 2023" />
<meta property="og:article:published_time" content="2023-03-08T01:12:00+08:00" />
<meta name="twitter:title" content="Road to Fed-Watching for Crypto (by Group &#34;Citadel2&#34;) ">
<meta name="twitter:description" content="Group Citadel2 Introduction In this group project, we set out to analyse the effects of Fed speeches on cryptocurrency returns with natural language processing (NLP) techniques. Given this aim, it is all but necessary to 1) collect data in a timely and accurate manner, and 2) process and analyse the …">

        <title>Road to Fed-Watching for Crypto (by Group &#34;Citadel2&#34;)  · MFIN7036 Student Blog 2023
</title>
        <link href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="MFIN7036 Student Blog 2023 - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/"><span class=site-name>MFIN7036 Student Blog 2023</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://buehlmaier.github.io/MFIN7036-student-blog-2023-02
                                    >Home</a>
                                </li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/categories.html">Categories</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/tags.html">Tags</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/road-to-fed-watching-for-crypto-by-group-citadel2.html">
                Road to Fed-Watching for Crypto (by Group "Citadel2")
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Group Citadel2</p>
<h2>Introduction</h2>
<p>In this group project, we set out to analyse the effects of Fed speeches on cryptocurrency returns with natural language processing (NLP) techniques. Given this aim, it is all but necessary to 1) collect data in a timely and accurate manner, and 2) process and analyse the data such that we can generate actionable insight with economic value. In this blog, we aim to shed some light on our process, as well as some of the challenges we faced.  </p>
<h2>Data Collection</h2>
<p>After each speech, their transcripts are uploaded to the <a href="https://www.federalreserve.gov/newsevents/speeches.htm">Federal Reserve website</a>. 
This allows us to use the following script to scrape the website and download the speeches: </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">scrap_FR_speech</span><span class="p">():</span> 
    <span class="c1"># scrap multiple FR speech text data </span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span> 
    <span class="c1"># Navigate to a webpage with pagination links </span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.federalreserve.gov/newsevents/speeches.htm&quot;</span><span class="p">)</span> 
    <span class="n">url</span><span class="o">=</span><span class="p">[]</span> 
    <span class="n">key_words</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">FR_speech</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  

    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">):</span> 
        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span> 
            <span class="n">passage_num</span> <span class="o">=</span> <span class="mi">13</span> 
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">passage_num</span> <span class="o">=</span> <span class="mi">21</span>    

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">passage_num</span><span class="p">):</span> 
            <span class="n">url</span><span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;//*[@id=&quot;article&quot;]/div[1]/div[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]/div[2]/p[1]/em/a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> 

            <span class="c1"># article text &amp; keywords </span>
            <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> 
            <span class="n">article</span><span class="o">.</span><span class="n">download</span><span class="p">()</span> 
            <span class="n">article</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span> 
            <span class="n">t</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">text</span> 
            <span class="c1"># article.nlp() </span>
            <span class="c1"># k = article.keywords </span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">t</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span> <span class="p">)</span> 
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span> 

            <span class="c1"># get article time </span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> 
            <span class="n">html_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> 

            <span class="c1"># Parse the HTML content with BeautifulSoup </span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span> 
            <span class="n">article_time</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;article__time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> 
            <span class="n">article_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">article_time</span><span class="p">,</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span> 
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;article_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">article_time</span> 
            <span class="n">FR_speech</span><span class="o">=</span> <span class="n">FR_speech</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> 

            <span class="c1"># key_words.append(k) </span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span><span class="s2">&quot;Next&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span> 

    <span class="k">return</span> <span class="n">FR_speech</span>         

<span class="n">FR_speech</span> <span class="o">=</span> <span class="n">scrap_FR_speech</span><span class="p">()</span> 
<span class="n">FR_speech</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;FR_speech.parquet&#39;</span><span class="p">)</span> 
</code></pre></div>

<h2>Data Processing</h2>
<p>For our purposes, speeches by Federal Reserve officials are a great source of text data, as they contain no gibberish, and the formal language allows for easy data augmentation – thus minimal cleaning is needed (compared to, for example, social media posts, which often contain abbreviations, emojis, slangs and/or colloquial language). However, we still need to inspect and clean the data – in case the downloaded text differs from that of the actual speech due to unexpected issues during web-scraping. </p>
<p>We first used the following code to drop references in the speech text. </p>
<div class="highlight"><pre><span></span><code><span class="n">FR_speech</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/Users/lancelotpan/Desktop/Module 4/NLP/Mfin 7036 group project/FR_speech.parquet&#39;</span><span class="p">)</span> 
<span class="n">FR_speech</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span> 

<span class="c1"># Drop reference in speech text </span>
<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]):</span> 
   <span class="n">lst</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> 
   <span class="n">item</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> 

   <span class="c1"># drop reference </span>
   <span class="n">lst</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span> 
   <span class="n">item</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> 
   <span class="n">item</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 

   <span class="c1"># drop notes </span>
   <span class="n">lst</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;. Return to text&#39;</span><span class="p">)</span> 
   <span class="n">item</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> 
   <span class="n">item</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 

   <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> 
</code></pre></div>

<p>We then applied a custom function to the text, which removes useless characters, and converts all letters to lowercase. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Drop useless characters and convert all words to lowercase </span>
<span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> 

    <span class="c1"># Remove links </span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;http://\S+|https://\S+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> 
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;http[s]?://\S+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> 
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;http\S+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> 

    <span class="c1"># remove the reference numbers  </span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.\d+&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  

    <span class="c1"># Remove multiple space characters </span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> 

    <span class="c1"># Convert to lowercase </span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 

    <span class="k">return</span> <span class="n">text</span> 

<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pre_process</span><span class="p">)</span> 
</code></pre></div>

<p>Now we can summarize the article, by removing stop words, then calculating the relative frequencies of each word, and finally rank each sentence by its relative importance.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Summarized the article (remove insignificant sentences) </span>
<span class="k">def</span> <span class="nf">sum_article</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> 
    <span class="kn">from</span> <span class="nn">spacy.lang.en.stop_words</span> <span class="kn">import</span> <span class="n">STOP_WORDS</span>  
    <span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>  
    <span class="kn">import</span> <span class="nn">en_core_web_sm</span> 
    <span class="n">nlp</span> <span class="o">=</span> <span class="n">en_core_web_sm</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> 
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> 

    <span class="c1"># remove create a dictionary of words and their respective frequencies  </span>
    <span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">sents</span> <span class="p">]</span> 
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">STOP_WORDS</span><span class="p">))</span>    
    <span class="n">cv_fit</span><span class="o">=</span><span class="n">cv</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>     
    <span class="n">word_list</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">();</span>     
    <span class="n">count_list</span> <span class="o">=</span> <span class="n">cv_fit</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
    <span class="n">word_frequency</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">word_list</span><span class="p">,</span><span class="n">count_list</span><span class="p">))</span> 

    <span class="c1"># compute the relative frequency of each word </span>
    <span class="n">val</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">word_frequency</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> 
    <span class="n">higher_word_frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="n">word_frequency</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]]</span> 

    <span class="c1"># gets relative frequency of words </span>
    <span class="n">higher_frequency</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_frequency</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>   
        <span class="n">word_frequency</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">word_frequency</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">/</span><span class="n">higher_frequency</span><span class="p">)</span> 

    <span class="c1"># Creating a ordered list (ascending order) of most important sentences </span>
    <span class="n">sentence_rank</span><span class="o">=</span><span class="p">{}</span> 
    <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">sents</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sent</span> <span class="p">:</span>        
            <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">word_frequency</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>             
                <span class="k">if</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sentence_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                    <span class="n">sentence_rank</span><span class="p">[</span><span class="n">sent</span><span class="p">]</span><span class="o">+=</span><span class="n">word_frequency</span><span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> 
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">sentence_rank</span><span class="p">[</span><span class="n">sent</span><span class="p">]</span><span class="o">=</span><span class="n">word_frequency</span><span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> 

    <span class="n">top_sentences</span><span class="o">=</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sentence_rank</span><span class="o">.</span><span class="n">values</span><span class="p">())[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
    <span class="n">top_sent</span><span class="o">=</span><span class="n">top_sentences</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> 

    <span class="n">summary</span><span class="o">=</span><span class="p">[]</span> 

    <span class="k">for</span> <span class="n">sent</span><span class="p">,</span><span class="n">strength</span> <span class="ow">in</span> <span class="n">sentence_rank</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
        <span class="c1"># print(sent) </span>
        <span class="k">if</span> <span class="n">strength</span> <span class="ow">in</span> <span class="n">top_sent</span><span class="p">:</span> 
            <span class="c1"># summary.append(sent) </span>
            <span class="n">temp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sent</span><span class="p">))</span> 
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">continue</span> 
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> 

<span class="n">summary0</span> <span class="o">=</span> <span class="n">sum_article</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> 

<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;summarized_article&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span> 

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;minutes_cleaned&#39;</span><span class="p">]):</span> 
    <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;summarized_article&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_article</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;summarized_article&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">])</span>      
</code></pre></div>

<p>Next, we split the passage into sentences using the NLTK sentence tokenizer, then finally removing outliers and errors before putting the data through the natural language processing model.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Turn passage to sentences </span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;tokenizers/punkt/english.pickle&#39;</span><span class="p">)</span> 
<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;summarized_article&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">)</span>  

<span class="c1"># Explode sentences into separate rows, keeping other data </span>
<span class="n">FR_speech</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;Sentences&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

<span class="nb">print</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences&#39;</span><span class="p">])</span> 

<span class="c1"># Drop the outliers </span>

<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span> 
<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences&#39;</span><span class="p">]):</span> 
    <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences_length&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
<span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="p">[</span> <span class="n">FR_speech</span><span class="p">[</span><span class="s1">&#39;Sentences_length&#39;</span><span class="p">]</span><span class="o">&gt;=</span> <span class="mi">63</span> <span class="p">][</span><span class="s1">&#39;Sentences&#39;</span><span class="p">]</span> 
<span class="n">FR_speech</span> <span class="o">=</span> <span class="n">FR_speech</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> 
</code></pre></div>

<p>As we are investigating the effects of Fed speeches on cryptocurrency prices, it is imperative to obtain accurate price data. For this project, we use the Yahoo! Finance API.  For the purposes of this project, the data provided by Yahoo! Finance has multiple benefits – there is complete OHLC price data at daily intervals, the data is easy to obtain via Python (with a specific purpose-built package), and it is available for public use at no cost. Here, we request for USD denominated Bitcoin prices (‘BTC-USD’)  between Sep 2014 and Feb 2023 from the Yahoo! Finance API via the yfinance package:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>

<span class="c1"># get Bitcoin trading data from Yahoo Finance</span>
<span class="n">btc</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;BTC-USD&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2014-09-17&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2023-02-28&#39;</span><span class="p">)</span>
</code></pre></div>

<h2>Model Evaluation</h2>
<p>For the model evaluation part, our initial idea was to directly link sentiment to price direction, but it would not be precise enough since other factors could affect it, so a two-model approach was selected in our project. The first step is to establish a model to determine the sentiment score, then use sentiment score and other factors to determine bitcoin price fluctuations. We changed our approach several times for the first model. </p>
<p>We first considered supervised machine learning with manually labelled data, but it is costly and time-consuming. Then, we regarded VADER as our second choice since VADER is a relatively simple and straightforward method with a lower computation cost. Additionally, unlike machine learning which requires the same format of the input, it does not require a fixed sentence length. Accordingly, we did a test to determine whether this method is appropriate or not. We imported a training set with an assumed 100% accuracy, then we converted positive sentiments to 1, negative to -1, and 0 otherwise. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">clean_sentiment</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span> <span class="ow">or</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span> <span class="ow">or</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;neg&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div>

<p>After that, we used the VADER code to generate sentiments from the text. </p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">VADER_polarize_by_max</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;compound&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">scores</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">clean_sentiment</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">VADER_polarize_by_compound</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="s1">&#39;compound&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">TextBlob_polarize_by_compound</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">polarity</span>
    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div>

<p>Unfortunately, the accuracy rate was only 53%, which is too low. </p>
<p>In this case, we believe that the low accuracy rate can be explained by the nature of the VADER model. VADER is a rule-based sentiment analysis model without explicitly coding it. For example, the score would be '+1' if the sentence has hawkish keywords and more positive than negative terms, and '-1' if the sentence conveys a dovish sentiment. This method can also be described as lexicon-based, where a sentiment score heavily relies on the polarity and intensity of the sentiment of a single word. All of this means that the VADER model ignores the contextual information as the BoW and TF-IDF. </p>
<p>We also considered unsupervised machine learning. However, its input data is not labelled by people in advance, instead the testing data is grouped automatically. Although no training set is required for unsupervised machine learning, the automated grouping may not be desirable as there is no particular indication. With a large number of specialised words in Federal Reserve speeches, it is impossible to tell the computer how to distinguish between these sentiments. </p>
<p>Therefore, after taking into account the pros and cons of each method, we decided to use supervised machine learning with different training sets (FiQA and FinancialPhraseBank). While this method has one limitation - in that these training sets are not entirely based on bitcoin, we can improve the accuracy by tuning and refining some parameters by ourselves, such as dropout, leaning rate, and weight decay. </p>
<h2>Next Steps</h2>
<p>After collecting and processing the Fed speech text data and the Bitcoin price data, as well as evaluating different methods for sentiment analysis, our next steps would be to put everything together and find insights on how Fed speeches factor into cryptocurrency returns.</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2023-03-08T01:12:00+08:00">Wed 08 March 2023</time>
            <h4>Category</h4>
            <a class="category-link" href="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/categories.html#progress-report-ref">Progress Report</a>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/buehlmaier/MFIN7036-student-blog-2023-02" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://buehlmaier.github.io/MFIN7036-student-blog-2023-02/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>